(this.webpackJsonpatlas=this.webpackJsonpatlas||[]).push([[0],{106:function(e,t,r){},107:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r.n(n),o=r(9),i=r.n(o),c=(r(55),r(8)),s=r(44),u=r(14),l=r(113),m=r(1),p=r(110),d=r(111),f=r(112),y=r(15),g=r(10),v=r.n(g),b=r(27),O=r.n(b);r(57);function E(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function h(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?E(Object(r),!0).forEach((function(t){Object(y.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):E(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var j=function(e,t){var r=t;if(e.current.getLayer(t)||e.current.getLayer("".concat(t,"1"))){r=e.current.getLayer(t)?"".concat(t,"1"):t;var n=e.current.getLayer(t)?t:"".concat(t,"1");e.current.removeLayer(n),e.current.removeSource(n)}return r},S=function(e,t,r){t.current.getCanvas().style.cursor="pointer";for(var n=e.features[0].geometry.coordinates.slice(),a=e.features[0].properties.description;Math.abs(e.lngLat.lng-n[0])>180;)n[0]+=e.lngLat.lng>n[0]?360:-360;r.current.setLngLat(n).setHTML(a).addTo(t.current)},w=function(e,t){e.current.getCanvas().style.cursor="",t.current.remove()},k={plotLine:function(e,t,r,n,a){var o=j(e,"route");e.current.addLayer({id:o,type:"line",source:{type:"geojson",data:{type:"Feature",properties:{},geometry:r}},layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#6f4cff","line-width":8}}).fitBounds(function(e){var t=new v.a.LngLat(e[0][0],e[0][1]),r=new v.a.LngLatBounds(t,t);return e.reduce((function(e,t){var r=Object(c.a)(t,2),n=r[0],a=r[1];return e.extend(new v.a.LngLat(n,a))}),r)}(r.coordinates),h({},a,{padding:{top:40,bottom:40,left:20,right:20}})),o=j(e,"locationMarkers"),e.current.addLayer({id:o,type:"symbol",source:{type:"geojson",data:{type:"FeatureCollection",features:r.coordinates.map((function(e){var t=Object(c.a)(e,4),r=t[0],a=t[1],o=t[2],i=t[3];return{type:"Feature",properties:{description:O.a.renderToString(n({type:"locationMarker",coordinates:[a,r],alt:o,recorded_at:i})),icon:"marker"},geometry:new _.Point({type:"Point",coordinates:[r,a]})}}))}},layout:{"icon-image":"{icon}-15","icon-allow-overlap":!1}}),e.current.on("mouseenter",o,(function(r){return S(r,e,t)})),e.current.on("mouseleave",o,(function(){return w(e,t)}))},useMarkers:function(e,t,r,n,a,o){r.current&&r.current.length&&r.current.forEach((function(e){return e.remove()}));var i=[],c=j(e,"deviceStatusMarkers");n.forEach((function(r){var n=r.start,o=r.end,c=r.deviceStatus,s=r.activity;if(n||o){var u=Y.getIcon(s||c),l=document.createElement("div");l.className="marker-container",l.innerHTML="<img src=".concat(Y.getImageSource(u)," alt=").concat(u,' class="marker-image"/>'),l.addEventListener("mouseenter",(function(n){return function(e,t,r,n,a){var o=n.start,i=n.end;t.current.getCanvas().style.cursor="pointer";var c=(o&&o.location?o.location.coordinates:i&&i.location?i.location.coordinates:[]).slice(),s=O.a.renderToString(a(h({type:"deviceStatusMarker"},n)));r.current.setLngLat(c).setHTML(s).addTo(t.current)}(0,e,t,r,a)})),l.addEventListener("mouseleave",(function(){return w(e,t)}));var m=n&&n.location?n.location.coordinates:o&&o.location?o.location.coordinates:[];i.push(new v.a.Marker(l).setLngLat(m).addTo(e.current))}})),e.current.on("mouseenter",c,(function(r){return S(r,e,t)})),e.current.on("mouseleave",c,(function(){return w(e,t)})),r.current=i}},N=r(28),_={Line:function e(t){var r=t.type,n=t.coordinates;Object(N.a)(this,e),this.type=r,this.coordinates=n},Point:function e(t){var r=t.type,n=t.coordinates;Object(N.a)(this,e),this.type=r,this.coordinates=n}},P=r(21);function L(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function T(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?L(Object(r),!0).forEach((function(t){Object(y.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):L(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var M={useMap:function(e,t){var r=t.accessToken,n=Object(P.a)(t,["accessToken"]),o=a.a.useRef();return a.a.useEffect((function(){o&&o.current||!r||(o.current=new v.a.Map(T({container:e,style:"mapbox://styles/mapbox/streets-v9",keyboard:!0,center:[0,0],accessToken:r},n)))}),[e,r]),a.a.useEffect((function(){r&&(v.a.accessToken=r)}),[r]),o},usePopup:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=a.a.useRef(new v.a.Popup(T({closeButton:!1,closeOnClick:!1},t)));return a.a.useEffect((function(){e.current&&e.current.on("load",(function(){r.current.addTo(e.current)}))}),[e,r]),r},useAccessToken:function(e,t){var r=a.a.useState(e),n=Object(c.a)(r,2),o=n[0],i=n[1];return a.a.useEffect((function(){if(e)localStorage.setItem("accessToken",e);else{var t=localStorage.getItem("accessToken");t&&(v.a.accessToken=t,i(t))}}),[e]),a.a.useEffect((function(){o?t():t("Missing access token")}),[o]),o}},I=r(43);function J(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function x(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?J(Object(r),!0).forEach((function(t){Object(y.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):J(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var D=r(58),C=r(59),A=new(r(60))({allErrors:!0}),B=A.compile(D),R=A.compile(C),F=function(e){var t=e.recorded_at,r=e.location,n={};return t&&(n.timestamp=t),r&&r.geometry&&(n.location=new _.Point(r.geometry)),n},z={geofence:function(e){var t=e.arrival,r=e.geofence,n=new _.Point(t.location.geometry),a=new _.Point(r.geometry);return{arrival:{arrivalPoint:n,arrivalTime:t.location.recorded_at},geofence:{geofencePoint:a,geofenceId:r.geofence_id,geofenceMetadata:JSON.stringify(r.metadata,null,2),radius:Number(r.radius)}}},device_status:function(e){var t=e.activity,r=e.duration,n=e.value,a=F(e.end),o=F(e.start),i={};return t&&(i.activity=t),r&&(i.duration=r),x({start:o,end:a,deviceStatus:n},i)}},H=function(e){var t=e.type,r=e.data;return z[t]?z[t](r):r},U=["disconnected","inactive","unknown","stop","walk","run","drive"],G={trip:B,LineString:R},Y={parseMarker:H,getIcon:function(e,t){return U.includes(t)?t:U.includes(e)?e:"unknown"},secondsToHms:function(e){e=Number(e);var t=Math.floor(e/3600),r=Math.floor(e%3600/60),n=Math.floor(e%3600%60);return(t>0?t+" h ":"")+(r>0?r+" m ":"")+(n>0?n+" s":"")},markersByType:function(e){return function(t){var r=e.reduce((function(e,t){return x({},e,Object(y.a)({},t.type,e[t.type]?[H(t)].concat(Object(I.a)(e[t.type])):[H(t)]))}),{});return t&&r[t]?r[t]:r}},validateInputJSON:function(e){var t=G[e.type||"trip"];return!(!t||t(e))&&t.errors},valid_device_status_states:U,getImageSource:function(e){return"".concat("/atlas","/assets/").concat(e,".png")}},q=(r(37),function(e){var t=e.trip,r=e.showTripModal,n=e.updateJson,o=e.hideModal,i=e.showModal,y=e.fetchError,g=a.a.useState(JSON.stringify(t,null,"\t")),v=Object(c.a)(g,2),b=v[0],O=v[1],E=a.a.useState(void 0),h=Object(c.a)(E,2),j=h[0],S=h[1],w=a.a.useState(void 0),k=Object(c.a)(w,2),N=k[0],_=k[1],P=y||N;a.a.useEffect((function(){JSON.stringify(t)!==JSON.stringify(b)&&O(JSON.stringify(t,null,"\t"))}),[t]),a.a.useEffect((function(){y&&y!==P&&_(y)}),[y]);var L=function(e){var t=Y.validateInputJSON(e);return t&&t.length?_(t):_(null),Boolean(t)};return a.a.createElement(a.a.Fragment,null,a.a.createElement(s.a,{intent:u.a.SUCCESS,className:"show-trip-button",onClick:function(){return r?o():i()}},"Update JSON"),a.a.createElement(l.a,{isOpen:P||r,title:"Add your own JSON",onClose:o,className:"dialog"},a.a.createElement("div",{className:m.a.DIALOG_BODY},a.a.createElement("div",{className:"dialog-container"},a.a.createElement(p.a,{value:b,disabled:!1,onChange:function(e){return O(e.target.value)},className:"user-summary-input",placeholder:"Paste trip_summary here",onBlur:function(e){e&&e.preventDefault();var t=e.target.value;if(t)try{var r=JSON.parse(t);L(r)}catch(n){console.error(n),_(n)}}}),P?a.a.createElement("div",{className:"error-table-container"},Array.isArray(P)?a.a.createElement(d.a,{className:"error-table",bordered:!0},a.a.createElement("caption",null,"There ",P.length>1?"are":"is an"," ",P.length>1?P.length:""," issue",P.length>1?"s":""),a.a.createElement("thead",null,a.a.createElement("tr",null,a.a.createElement("th",null,"Location"),a.a.createElement("th",null,"Issue"))),a.a.createElement("tbody",null,P.map((function(e){return a.a.createElement("tr",{key:e.dataPath},a.a.createElement("td",null,a.a.createElement("div",{className:"table-content"},e.dataPath)),a.a.createElement("td",null,a.a.createElement("div",{className:"table-content"},e.message)))})))):a.a.createElement("div",{className:"error-table error"},P.message?P.message:JSON.stringify(P))):null)),a.a.createElement("div",{className:m.a.DIALOG_FOOTER},a.a.createElement("div",{className:m.a.DIALOG_FOOTER_ACTIONS},a.a.createElement(f.a,{text:j,buttonText:"Browse",className:"file-input",onInputChange:function(e){e&&e.preventDefault();var t=new FileReader,r=e.target.files[0];S(r&&r.name?r.name:void 0),t.readAsText(r,"UTF-8"),t.onload=function(e){var t=e.target.result,r=JSON.parse(t);O(t),L(r)||(n(r),o())}},inputProps:{accept:".json"}}),a.a.createElement(s.a,{disabled:P&&P.length||!b,onClick:function(e){O(JSON.stringify(t,null,"\t")),o()}},"Close"),a.a.createElement(s.a,{intent:u.a.PRIMARY,disabled:P&&P.length||!b,onClick:function(e){try{var t=JSON.parse(b);n(t),o()}catch(r){console.error(r),_(r)}}},"Update")))))}),K=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"],Q=function(e){return K[e.getMonth()]+" "+e.getDate()+", "+e.getFullYear()+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()},V={deviceStatusMarker:function(e){var t=e.start,r=e.end,n=(e.deviceStatus,e.activity),o=e.duration;return a.a.createElement("tbody",null,t?a.a.createElement("tr",{className:"capitalize"},a.a.createElement("td",null,"Start Time"),a.a.createElement("td",null,Q(new Date(t.timestamp)))):null,r?a.a.createElement("tr",{className:"capitalize"},a.a.createElement("td",null,"End Time"),a.a.createElement("td",null,Q(new Date(r.timestamp)))):null,o?a.a.createElement("tr",null,a.a.createElement("td",null,"Duration"),a.a.createElement("td",null,Y.secondsToHms(o))):null,n?a.a.createElement("tr",null,a.a.createElement("td",null,"Activity"),a.a.createElement("td",{className:"capitalize"},n)):null)},locationMarker:function(e){var t=Object(c.a)(e.coordinates,2),r=t[0],n=t[1],o=e.alt,i=e.recorded_at;return a.a.createElement("tbody",null,a.a.createElement("tr",null,a.a.createElement("td",null,"Coordinates"),a.a.createElement("td",{className:"capitalize"},r," ",n)),o?a.a.createElement("tr",null,a.a.createElement("td",null,"Altitude"),a.a.createElement("td",{className:"capitalize"},o)):null,i?a.a.createElement("tr",null,a.a.createElement("td",null,"Recorded at"),a.a.createElement("td",{className:"capitalize"},Q(new Date(i)))):null)}},W={locationMarker:function(){return"location"},deviceStatusMarker:function(e){return e.deviceStatus}},X=function(e){var t=e.type,r=Object(P.a)(e,["type"]);return a.a.createElement("table",{className:"device-status-table"},a.a.createElement("thead",null,a.a.createElement("tr",null,a.a.createElement("th",{colSpan:2,className:"capitalize"},W[t](r)))),V[t](r))},Z=(r(104),r(105),r(106),"map-container"),$=function(e){return a.a.createElement(X,e)},ee=new URLSearchParams(window.location.search),te=ee.get("gist"),re=ee.get("locations"),ne="true"===ee.get("shed_animation"),ae=ee.get("accessToken"),oe=!ee.get("hash")||"false"!==ee.get("hash"),ie=JSON.parse(re);var ce=function(){var e=a.a.useState(!0),t=Object(c.a)(e,2),r=t[0],n=t[1],o=a.a.useState(void 0),i=Object(c.a)(o,2),s=i[0],u=i[1],l=a.a.useState(void 0),m=Object(c.a)(l,2),p=m[0],d=m[1],f=M.useAccessToken(ae,d),y={linear:ne},g=M.useMap(Z,{accessToken:f,hash:oe,fitBoundsOptions:y}),v=M.usePopup(g),b=M.usePopup(g,{offset:10}),O=a.a.useRef([]);a.a.useEffect((function(){if(f)if(te){var e=te.split("/").pop();fetch("https://api.github.com/gists/".concat(e)).then((function(e){return e.json()})).then((function(e){if(e.message)console.error(e.message),d(e.message);else{var t=JSON.parse(e.files["default.json"]?e.files["default.json"].content:Object.values(e.files)[0].content);u(t)}})).catch((function(e){console.error(e),d(e)}))}else if(ie&&ie.length){var t=new _.Line({coordinates:ie,type:"LineString"});g.current.on("load",(function(){return E(t,!0,!1)}))}else{var r=localStorage.getItem("previousJSON"),n=JSON.parse(r);n&&g.current.on("load",(function(){return E(n,!0)}))}}),[f]);var E=function(e,t,r){if(u(e),t||localStorage.setItem("previousJSON",JSON.stringify(e,null,"\t")),"LineString"===e.type){var a=new _.Line(e);k.plotLine(g,v,a,$,y),r||n(!1)}else try{var o=e.summary,i=o.locations,c=o.markers,s=new _.Line(i),l=Y.markersByType(c)("device_status");k.plotLine(g,v,s,$,y),k.useMarkers(g,b,O,l,$)}catch(p){console.error(p),d(p)}};return a.a.createElement("div",{className:"app-container"},f&&a.a.createElement("div",{id:Z}),a.a.createElement(q,{fetchError:p,trip:s,showTripModal:r,showModal:function(){return n(!0)},hideModal:function(){return n(!1)},updateJson:E}))};i.a.render(a.a.createElement(ce,null),document.getElementById("root"))},37:function(e,t,r){},50:function(e,t,r){e.exports=r(107)},55:function(e,t,r){},57:function(e,t,r){},58:function(e){e.exports=JSON.parse('{"properties":{"trip_id":{"type":"string","format":"uuid"},"device_id":{"type":"string","format":"uuid"},"started_at":{"type":"string","format":"date-time"},"completed_at":{"type":"string","format":"date-time"},"status":{"type":"string"},"views":{"properties":{"embed_url":{"type":"string","format":"uri"},"share_url":{"type":"string","format":"uri"}}},"analytics":{"properties":{"total_duration":{"type":"number"},"active_count":{"type":"number"},"active_duration":{"type":"number"},"stop_count":{"type":"number"},"stop_duration":{"type":"number"},"active_distance":{"type":"number"},"walk_count":{"type":"number"},"walk_duration":{"type":"number"},"walk_distance":{"type":"number"},"drive_count":{"type":"number"},"drive_duration":{"type":"number"},"drive_distance":{"type":"number"},"inactive_count":{"type":"number"},"inactive_duration":{"type":"number"}}},"summary":{"properties":{"distance":{"type":"number"},"duration":{"type":"number"},"started_at":{"type":"string","format":"date-time"},"completed_at":{"type":"string","format":"date-time"},"device_id":{"type":"string","format":"uuid"},"locations":{"properties":{"type":{"type":"string"},"coordinates":{"type":"array","items":{"type":"array","maxItems":4,"minItems":2,"items":[{"type":"number","minimum":-179.999999,"maximum":179.999999},{"type":"number","minimum":-89.999999,"maximum":89.999999},{"type":["number","null"],"minimum":-12262,"maximum":11000},{"type":"string","format":"date-time"}]}}}},"markers":{"type":"array","items":[{"properties":{"type":{"type":"string"},"data":{"properties":{"activity":{"type":"string"},"duration":{"type":"number"},"value":{"type":"string"},"start":{"properties":{"recorded_at":{"type":"string","format":"date-time"},"location":{"properties":{"recorded_at":{"type":"string","format":"date-time"},"geometry":{"properties":{"type":{"type":"string"},"coordinates":{"type":"array","maxItems":4,"minItems":2,"items":[{"type":"number","minimum":-179.999999,"maximum":179.999999},{"type":"number","minimum":-89.999999,"maximum":89.999999},{"type":["number","null"],"minimum":-12262,"maximum":11000},{"type":"string","format":"date-time"}]}}}}}}},"end":{"properties":{"recorded_at":{"type":"string","format":"date-time"},"location":{"properties":{"recorded_at":{"type":"string","format":"date-time"},"geometry":{"properties":{"type":{"type":"string"},"coordinates":{"type":"array","maxItems":4,"minItems":2,"items":[{"type":"number","minimum":-179.999999,"maximum":179.999999},{"type":"number","minimum":-89.999999,"maximum":89.999999},{"type":["number","null"],"minimum":-12262,"maximum":11000},{"type":"string","format":"date-time"}]}}}}}}}}}}}]}}}}}')},59:function(e){e.exports=JSON.parse('{"properties":{"type":{"type":"string"},"coordinates":{"type":"array","items":{"type":"array","maxItems":4,"minItems":2,"items":[{"type":"number","minimum":-179.999999,"maximum":179.999999},{"type":"number","minimum":-89.999999,"maximum":89.999999},{"type":["number","null"],"minimum":-12262,"maximum":11000},{"type":"string","format":"date-time"}]}}}}')}},[[50,1,2]]]);
//# sourceMappingURL=main.dcf96389.chunk.js.map