{"version":3,"sources":["common/map-utils.js","common/map-classes.js","common/map-hooks.js","common/utils.js","components/TripInfoModal.js","components/DeviceStatusTable.js","App.js","index.js"],"names":["getNewLayerRemoveOldLayer","mapRef","primitive","newLayerId","current","getLayer","oldLayerId","removeLayer","removeSource","mouseEnterCallback","e","popupRef","getCanvas","style","cursor","coordinates","features","geometry","slice","description","properties","Math","abs","lngLat","lng","setLngLat","setHTML","addTo","mouseLeaveCallback","remove","getLayerName","index","primitiveName","lineColorMap","_zero_","_one_","plotLine","line","getStatusTable","fitBoundsOptions","addLayer","id","type","source","data","layout","paint","fitBounds","point","mapboxgl","LngLat","initBounds","LngLatBounds","reduce","bounds","lat","extend","computeBounds","padding","top","bottom","left","right","map","alt","recorded_at","ReactDOMServer","renderToString","icon","classes","Point","on","event","useMarkers","markersRef","deviceStatusMarkers","markerList","deviceStatusMarker","start","end","deviceStatus","activity","variant","utils","getIcon","markerElement","document","createElement","className","innerHTML","getImageSource","addEventListener","location","mouseClickCallback","Marker","filter","Boolean","Line","this","useMap","container","options","accessToken","rest","React","useRef","useEffect","Map","keyboard","center","usePopup","Popup","closeButton","closeOnClick","useAccessToken","urlToken","errorHandler","useState","updateAccessToken","localStorage","setItem","knownToken","getItem","trip_schema","require","LineString_schema","ajv","allErrors","trip_validator","compile","LineString_validator","getStartEndData","acc","timestamp","markerTypeMap","geofence","marker","arrival","arrivalPoint","geofencePoint","arrivalTime","geofenceId","geofence_id","geofenceMetadata","JSON","stringify","metadata","radius","Number","device_status","duration","value","extra","parseMarker","valid_device_status_states","validatorMap","trip","LineString","actions","updateJson","addNewJson","changeJsonIndex","actionMap","state","payload","newState","json","jsons","noPageChange","currentJson","newPosition","includes","secondsToHms","d","h","floor","m","s","markersByType","markers","allMarkers","currentMarker","validateInputJSON","validate","errors","process","baseReducer","reducerActions","TripInfoModal","showTripModal","hideModal","showModal","fetchError","currentJsonIndex","goToPageZero","userJson","updateUserJson","undefined","filename","updateFilename","localErrors","updateErrors","modify","validateInput","tripJSON","validationErrors","length","handleUpdateJson","updatedJson","parse","error","console","intent","Intent","SUCCESS","onClick","isOpen","title","onClose","isCloseButtonShown","canEscapeKeyClose","canOutsideClickClose","Classes","DIALOG_BODY","disabled","onChange","target","placeholder","onBlur","preventDefault","Array","isArray","bordered","key","dataPath","message","DIALOG_FOOTER","DIALOG_FOOTER_ACTIONS","text","buttonText","onInputChange","fileReader","FileReader","file","files","name","readAsText","onload","onloadEvent","derivedFileValue","result","inputProps","accept","PRIMARY","months","formatDate","getMonth","getDate","getFullYear","getHours","getMinutes","getSeconds","rowMap","Date","locationMarker","headerMap","DeviceStatusTable","props","colSpan","mapContainerId","params","URLSearchParams","window","search","gistURL","get","locationArrays","shed_animation","urlAccessToken","hash","App","updateShowTripModal","updateError","useReducer","dispatch","hooks","linear","locationPopupRef","deviceStatusPopupRef","offset","gistId","split","pop","fetch","then","response","content","Object","values","catch","handleJsonUpdate","fromLocalStorage","previousJSON","indexNameMap","0","1","forEach","mapUtils","summary","locations","fromLocalstorage","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.c93a35e8.chunk.js","sourcesContent":["import mapboxgl from \"mapbox-gl\";\nimport ReactDOMServer from \"react-dom/server\";\n\nimport { utils, classes } from \"./\";\n\nimport \"./index.css\";\n\nconst computeBounds = coordinates => {\n  const point = new mapboxgl.LngLat(coordinates[0][0], coordinates[0][1]);\n  const initBounds = new mapboxgl.LngLatBounds(point, point);\n  return coordinates.reduce(\n    (bounds, [lng, lat]) => bounds.extend(new mapboxgl.LngLat(lng, lat)),\n    initBounds\n  );\n};\n\nconst getNewLayerRemoveOldLayer = (mapRef, primitive) => {\n  let newLayerId = primitive;\n  if (\n    mapRef.current.getLayer(primitive) ||\n    mapRef.current.getLayer(`${primitive}1`)\n  ) {\n    newLayerId = mapRef.current.getLayer(primitive)\n      ? `${primitive}1`\n      : primitive;\n    const oldLayerId = mapRef.current.getLayer(primitive)\n      ? primitive\n      : `${primitive}1`;\n    mapRef.current.removeLayer(oldLayerId);\n    mapRef.current.removeSource(oldLayerId);\n  }\n  return newLayerId;\n};\n\nconst mouseEnterCallback = (e, mapRef, popupRef) => {\n  mapRef.current.getCanvas().style.cursor = \"pointer\";\n  let coordinates = e.features[0].geometry.coordinates.slice();\n  const description = e.features[0].properties.description;\n  while (Math.abs(e.lngLat.lng - coordinates[0]) > 180)\n    coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;\n  popupRef.current\n    .setLngLat(coordinates)\n    .setHTML(description)\n    .addTo(mapRef.current);\n};\n\nconst mouseClickCallback = (\n  e,\n  mapRef,\n  popupRef,\n  deviceStatusMarker,\n  getStatusTable\n) => {\n  const { start, end } = deviceStatusMarker;\n  mapRef.current.getCanvas().style.cursor = \"pointer\";\n  const location =\n    start && start.location\n      ? start.location.coordinates\n      : end && end.location\n      ? end.location.coordinates\n      : [];\n  let coordinates = location.slice();\n  const description = ReactDOMServer.renderToString(\n    getStatusTable({\n      type: \"deviceStatusMarker\",\n      ...deviceStatusMarker\n    })\n  );\n  popupRef.current\n    .setLngLat(coordinates)\n    .setHTML(description)\n    .addTo(mapRef.current);\n};\n\nconst mouseLeaveCallback = (mapRef, popupRef) => {\n  mapRef.current.getCanvas().style.cursor = \"\";\n  popupRef.current.remove();\n};\n\nconst getLayerName = index => primitiveName => primitiveName + index;\n\nconst lineColorMap = {\n  _zero_: \"#6397FF\",\n  _one_: \"#FF8D69\"\n};\n\nconst plotLine = ({\n  mapRef,\n  popupRef,\n  line,\n  getStatusTable,\n  fitBoundsOptions,\n  index\n}) => {\n  let newLayerId = getNewLayerRemoveOldLayer(\n    mapRef,\n    getLayerName(index)`route`\n  );\n  mapRef.current\n    .addLayer({\n      id: newLayerId,\n      type: \"line\",\n      source: {\n        type: \"geojson\",\n        data: {\n          type: \"Feature\",\n          properties: {},\n          geometry: line\n        }\n      },\n      layout: {\n        \"line-join\": \"round\",\n        \"line-cap\": \"round\"\n      },\n      paint: {\n        \"line-color\": lineColorMap[index],\n        \"line-width\": 8\n      }\n    })\n    .fitBounds(computeBounds(line.coordinates), {\n      ...fitBoundsOptions,\n      padding: { top: 40, bottom: 40, left: 20, right: 20 }\n    });\n\n  newLayerId = getNewLayerRemoveOldLayer(\n    mapRef,\n    getLayerName(index)`locationMarkers`\n  );\n  mapRef.current.addLayer({\n    id: newLayerId,\n    type: \"symbol\",\n    source: {\n      type: \"geojson\",\n      data: {\n        type: \"FeatureCollection\",\n        features: line.coordinates.map(([lng, lat, alt, recorded_at]) => ({\n          type: \"Feature\",\n          properties: {\n            description: ReactDOMServer.renderToString(\n              getStatusTable({\n                type: \"locationMarker\",\n                coordinates: [lat, lng],\n                alt,\n                recorded_at\n              })\n            ),\n            icon: \"marker\"\n          },\n          geometry: new classes.Point({\n            type: \"Point\",\n            coordinates: [lng, lat]\n          })\n        }))\n      }\n    },\n    layout: {\n      \"icon-image\": \"{icon}-15\",\n      \"icon-allow-overlap\": false\n    }\n  });\n\n  mapRef.current.on(\"mouseenter\", newLayerId, event =>\n    mouseEnterCallback(event, mapRef, popupRef)\n  );\n\n  mapRef.current.on(\"mouseleave\", newLayerId, () =>\n    mouseLeaveCallback(mapRef, popupRef)\n  );\n};\n\nconst useMarkers = ({\n  mapRef,\n  popupRef,\n  markersRef,\n  deviceStatusMarkers,\n  getStatusTable,\n  fitBoundsOptions,\n  index\n}) => {\n  const newLayerId = getNewLayerRemoveOldLayer(\n    mapRef,\n    getLayerName(index)`deviceStatusMarkers`\n  );\n  const markerList = deviceStatusMarkers\n    .map(deviceStatusMarker => {\n      const { start, end, deviceStatus, activity } = deviceStatusMarker;\n      if (start || end) {\n        const variant = utils.getIcon(activity || deviceStatus);\n        const markerElement = document.createElement(\"div\");\n        markerElement.className = \"marker-container\";\n\n        markerElement.innerHTML = `<img src=${utils.getImageSource(\n          variant\n        )} alt=${variant} class=\"marker-image\"/>`;\n\n        markerElement.addEventListener(\"mouseenter\", event =>\n          mouseClickCallback(\n            event,\n            mapRef,\n            popupRef,\n            deviceStatusMarker,\n            getStatusTable\n          )\n        );\n        markerElement.addEventListener(\"mouseleave\", () =>\n          mouseLeaveCallback(mapRef, popupRef)\n        );\n        const location =\n          start && start.location\n            ? start.location.coordinates\n            : end && end.location\n            ? end.location.coordinates\n            : [];\n        return new mapboxgl.Marker(markerElement)\n          .setLngLat(location)\n          .addTo(mapRef.current);\n      }\n      return null;\n    })\n    .filter(Boolean);\n\n  mapRef.current.on(\"mouseenter\", newLayerId, event =>\n    mouseEnterCallback(event, mapRef, popupRef)\n  );\n\n  mapRef.current.on(\"mouseleave\", newLayerId, () =>\n    mouseLeaveCallback(mapRef, popupRef)\n  );\n  markersRef.current = markerList;\n};\n\nexport default {\n  plotLine,\n  useMarkers\n};\n","class Line {\n  constructor({ type, coordinates }) {\n    this.type = type;\n    this.coordinates = coordinates;\n  }\n}\n\nclass Point {\n  constructor({ type, coordinates }) {\n    this.type = type;\n    this.coordinates = coordinates;\n  }\n}\n\nexport default {\n  Line,\n  Point\n};\n","import React from \"react\";\nimport mapboxgl from \"mapbox-gl\";\n\nconst useMap = (container, options) => {\n  const { accessToken, ...rest } = options;\n  const mapRef = React.useRef();\n  React.useEffect(() => {\n    if ((!mapRef || !mapRef.current) && accessToken)\n      mapRef.current = new mapboxgl.Map({\n        container,\n        style: \"mapbox://styles/mapbox/streets-v9\",\n        keyboard: true,\n        center: [0, 0],\n        accessToken,\n        ...rest\n      });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [container, accessToken]);\n\n  React.useEffect(() => {\n    if (accessToken) mapboxgl.accessToken = accessToken;\n  }, [accessToken]);\n  return mapRef;\n};\n\nconst usePopup = (mapRef, options = {}) => {\n  const popupRef = React.useRef(\n    new mapboxgl.Popup({\n      closeButton: false,\n      closeOnClick: false,\n      ...options\n    })\n  );\n  React.useEffect(() => {\n    if (mapRef.current)\n      mapRef.current.on(\"load\", () => {\n        popupRef.current.addTo(mapRef.current);\n      });\n  }, [mapRef, popupRef]);\n  return popupRef;\n};\n\nconst useAccessToken = (urlToken, errorHandler) => {\n  const [accessToken, updateAccessToken] = React.useState(urlToken);\n  React.useEffect(() => {\n    if (!urlToken) {\n      const knownToken = localStorage.getItem(\"accessToken\");\n      if (knownToken) {\n        mapboxgl.accessToken = knownToken;\n        updateAccessToken(knownToken);\n      }\n    } else localStorage.setItem(\"accessToken\", urlToken);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [urlToken]);\n  React.useEffect(() => {\n    if (accessToken) errorHandler();\n    else errorHandler(\"Missing access token\");\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [accessToken]);\n  return accessToken;\n};\n\nexport default {\n  useMap,\n  usePopup,\n  useAccessToken\n};\n","import { classes } from \"./\";\nconst trip_schema = require(\"../template/trip_schema.json\");\nconst LineString_schema = require(\"../template/LineString_schema.json\");\n\nconst Ajv = require(\"ajv\");\nconst ajv = new Ajv({ allErrors: true });\nconst trip_validator = ajv.compile(trip_schema);\nconst LineString_validator = ajv.compile(LineString_schema);\n\nconst parseGeofenceMarker = marker => {\n  const { arrival, geofence } = marker;\n  const arrivalPoint = new classes.Point(arrival.location.geometry);\n  const geofencePoint = new classes.Point(geofence.geometry);\n  const arrivalTime = arrival.location.recorded_at;\n  const geofenceId = geofence.geofence_id;\n  const geofenceMetadata = JSON.stringify(geofence.metadata, null, 2);\n  const radius = Number(geofence.radius);\n  return {\n    arrival: {\n      arrivalPoint,\n      arrivalTime\n    },\n    geofence: {\n      geofencePoint,\n      geofenceId,\n      geofenceMetadata,\n      radius\n    }\n  };\n};\n\nconst getStartEndData = ({ recorded_at, location }) => {\n  let acc = {};\n  if (recorded_at) acc.timestamp = recorded_at;\n  if (location && location.geometry)\n    acc.location = new classes.Point(location.geometry);\n  return acc;\n};\n\nconst parseDeviceStatusMarker = marker => {\n  const { activity, duration } = marker;\n  const deviceStatus = marker.value;\n  const end = getStartEndData(marker.end);\n  const start = getStartEndData(marker.start);\n  let extra = {};\n  if (activity) extra.activity = activity;\n  if (duration) extra.duration = duration;\n  return { start, end, deviceStatus, ...extra };\n};\n\nconst markerTypeMap = {\n  geofence: parseGeofenceMarker,\n  device_status: parseDeviceStatusMarker\n};\n\nconst parseMarker = ({ type, data }) =>\n  markerTypeMap[type] ? markerTypeMap[type](data) : data;\n\nconst valid_device_status_states = [\n  \"disconnected\",\n  \"inactive\",\n  \"unknown\",\n  \"stop\",\n  \"walk\",\n  \"run\",\n  \"drive\"\n];\n\nconst getImageSource = variant =>\n  `${process.env.PUBLIC_URL}/assets/${variant}.png`;\n\nconst getIcon = (deviceStatus, activity) =>\n  valid_device_status_states.includes(activity)\n    ? activity\n    : valid_device_status_states.includes(deviceStatus)\n    ? deviceStatus\n    : \"unknown\";\n\nconst markersByType = markers => type => {\n  const allMarkers = markers.reduce(\n    (markers, currentMarker) => ({\n      ...markers,\n      [currentMarker.type]: markers[currentMarker.type]\n        ? [parseMarker(currentMarker), ...markers[currentMarker.type]]\n        : [parseMarker(currentMarker)]\n    }),\n    {}\n  );\n  return type && allMarkers[type] ? allMarkers[type] : allMarkers;\n};\n\nconst secondsToHms = d => {\n  d = Number(d);\n  const h = Math.floor(d / 3600);\n  const m = Math.floor((d % 3600) / 60);\n  const s = Math.floor((d % 3600) % 60);\n\n  const hDisplay = h > 0 ? h + \" h \" : \"\";\n  const mDisplay = m > 0 ? m + \" m \" : \"\";\n  const sDisplay = s > 0 ? s + \" s\" : \"\";\n  return hDisplay + mDisplay + sDisplay;\n};\n\nconst validatorMap = {\n  trip: trip_validator,\n  LineString: LineString_validator\n};\n\nconst validateInputJSON = json => {\n  const validate = validatorMap[json.type || \"trip\"];\n  const valid = validate ? validate(json) : true;\n  return !valid ? validate.errors : false;\n};\n\nconst updateJson = \"UPDATE_JSON\";\nconst addNewJson = \"ADD_NEW_JSON\";\nconst changeJsonIndex = \"UPDATE_JSON_INDEX\";\n\nconst actions = {\n  updateJson,\n  addNewJson,\n  changeJsonIndex\n};\n\nconst actionMap = {\n  [actions.updateJson]: (state, payload) => {\n    let newState = { ...state };\n    const { index, json } = payload;\n    newState.jsons[index] = json;\n    return newState;\n  },\n  [actions.addNewJson]: (state, payload) => {\n    let newState = { ...state };\n    const { json, noPageChange } = payload;\n    newState.jsons[state.currentJson] = json;\n    const newPosition = noPageChange ? state.currentJson : 1;\n    newState.currentJson = newPosition;\n    return newState;\n  },\n  [actions.changeJsonIndex]: (state, { index }) => {\n    let newState = { ...state };\n    newState.currentJson = index;\n    return newState;\n  }\n};\n\nconst baseReducer = (state, { type, ...payload }) =>\n  actionMap[type] ? actionMap[type](state, payload) : state;\n\nexport default {\n  parseMarker,\n  getIcon,\n  secondsToHms,\n  markersByType,\n  validateInputJSON,\n  valid_device_status_states,\n  getImageSource,\n  baseReducer,\n  reducerActions: actions\n};\n","import React from \"react\";\nimport {\n  TextArea,\n  Dialog,\n  Button,\n  Classes,\n  Intent,\n  FileInput,\n  HTMLTable\n} from \"@blueprintjs/core\";\n\nimport { utils } from \"./../common\";\n\nimport \"./component.css\";\n\nconst getDialogTitle = modify => (modify ? \"Modify data\" : \"Add your own JSON\");\n\nconst TripInfoModal = ({\n  trip,\n  showTripModal,\n  updateJson,\n  hideModal,\n  showModal,\n  fetchError,\n  currentJsonIndex,\n  goToPageZero\n}) => {\n  const [userJson, updateUserJson] = React.useState(\n    JSON.stringify(trip, null, \"\\t\")\n  );\n  const [filename, updateFilename] = React.useState(undefined);\n  const [localErrors, updateErrors] = React.useState(undefined);\n\n  const errors = fetchError || localErrors;\n\n  React.useEffect(() => {\n    if (JSON.stringify(trip) !== JSON.stringify(userJson))\n      updateUserJson(JSON.stringify(trip, null, \"\\t\"));\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [trip]);\n\n  React.useEffect(() => {\n    if (fetchError && fetchError !== errors) updateErrors(fetchError);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [fetchError]);\n\n  const validateInput = tripJSON => {\n    const validationErrors = utils.validateInputJSON(tripJSON);\n    if (validationErrors && validationErrors.length)\n      updateErrors(validationErrors);\n    else updateErrors(null);\n    return Boolean(validationErrors);\n  };\n\n  const handleUpdateJson = addNewJson => {\n    try {\n      const updatedJson = JSON.parse(userJson);\n      if (addNewJson)\n        updateJson({ json: updatedJson, showModal: !currentJsonIndex });\n      else\n        updateJson({ json: updatedJson, showModal: true, noPageChange: true });\n    } catch (error) {\n      console.error(error);\n      updateErrors(error);\n    }\n  };\n\n  const handleCloseModal = e => {\n    updateUserJson(JSON.stringify(trip, null, \"\\t\"));\n    hideModal();\n  };\n\n  const handleFileUpload = event => {\n    event && event.preventDefault();\n    const fileReader = new FileReader();\n    const file = event.target.files[0];\n    updateFilename(file && file.name ? file.name : undefined);\n    fileReader.readAsText(file, \"UTF-8\");\n    fileReader.onload = onloadEvent => {\n      const derivedFileValue = onloadEvent.target.result;\n      const tripJSON = JSON.parse(derivedFileValue);\n      updateUserJson(derivedFileValue);\n      if (!validateInput(tripJSON)) {\n        updateJson(tripJSON);\n        hideModal();\n      }\n    };\n  };\n\n  const handleBlurEvent = event => {\n    event && event.preventDefault();\n    const value = event.target.value;\n    if (value)\n      try {\n        const tripJSON = JSON.parse(value);\n        validateInput(tripJSON);\n      } catch (error) {\n        console.error(error);\n        updateErrors(error);\n      }\n  };\n\n  const checkPreviousJson = event => {\n    event && event.preventDefault();\n    try {\n      const updatedJson = JSON.parse(userJson);\n      if (updatedJson) updateJson(updatedJson, false, true);\n      goToPageZero();\n    } catch (error) {\n      console.error(error);\n      updateErrors(error);\n    }\n  };\n\n  return (\n    <>\n      <Button\n        intent={Intent.SUCCESS}\n        className={\"show-trip-button\"}\n        onClick={() => (showTripModal ? hideModal() : showModal())}\n      >\n        Update JSON\n      </Button>\n      <Dialog\n        isOpen={errors || showTripModal}\n        title={getDialogTitle(Boolean(trip))}\n        onClose={hideModal}\n        className=\"dialog\"\n        isCloseButtonShown={false}\n        canEscapeKeyClose={false}\n        canOutsideClickClose={false}\n      >\n        <div className={Classes.DIALOG_BODY}>\n          <div className=\"dialog-container\">\n            <TextArea\n              value={userJson || \"\"}\n              disabled={false}\n              onChange={e => updateUserJson(e.target.value)}\n              className={\"user-summary-input\"}\n              placeholder={\"Paste trip_summary here\"}\n              onBlur={handleBlurEvent}\n            />\n            {errors ? (\n              <div className={\"error-table-container\"}>\n                {Array.isArray(errors) ? (\n                  <HTMLTable className={\"error-table\"} bordered>\n                    <caption>\n                      There {errors.length > 1 ? \"are\" : \"is an\"}{\" \"}\n                      {errors.length > 1 ? errors.length : \"\"} issue\n                      {errors.length > 1 ? \"s\" : \"\"}\n                    </caption>\n                    <thead>\n                      <tr>\n                        <th>Location</th>\n                        <th>Issue</th>\n                      </tr>\n                    </thead>\n                    <tbody>\n                      {errors.map(error => (\n                        <tr key={error.dataPath}>\n                          <td>\n                            <div className=\"table-content\">\n                              {error.dataPath}\n                            </div>\n                          </td>\n                          <td>\n                            <div className=\"table-content\">{error.message}</div>\n                          </td>\n                        </tr>\n                      ))}\n                    </tbody>\n                  </HTMLTable>\n                ) : (\n                  <div className=\"error-table error\">\n                    {errors.message ? errors.message : JSON.stringify(errors)}\n                  </div>\n                )}\n              </div>\n            ) : null}\n          </div>\n        </div>\n        <div className={Classes.DIALOG_FOOTER}>\n          <div className={Classes.DIALOG_FOOTER_ACTIONS}>\n            <FileInput\n              text={filename}\n              buttonText={\"Browse\"}\n              className=\"file-input\"\n              onInputChange={handleFileUpload}\n              inputProps={{ accept: \".json\" }}\n            />\n            {currentJsonIndex ? (\n              <Button\n                icon=\"caret-left\"\n                className=\"add-new-json\"\n                disabled={errors && errors.length}\n                onClick={checkPreviousJson}\n              >\n                Check previous JSON\n              </Button>\n            ) : (\n              <Button\n                icon=\"plus\"\n                className=\"add-new-json\"\n                disabled={(errors && errors.length) || !userJson}\n                onClick={() => handleUpdateJson(true)}\n              >\n                Add another JSON\n              </Button>\n            )}\n            <Button\n              disabled={(errors && errors.length) || !userJson}\n              onClick={handleCloseModal}\n            >\n              Close\n            </Button>\n            <Button\n              intent={Intent.PRIMARY}\n              disabled={(errors && errors.length) || !userJson}\n              onClick={() => handleUpdateJson()}\n            >\n              Update\n            </Button>\n          </div>\n        </div>\n      </Dialog>\n    </>\n  );\n};\n\nexport default TripInfoModal;\n","import React from \"react\";\n\nimport { utils } from \"./../common\";\n\nimport \"./component.css\";\n\nconst months = [\n  \"jan\",\n  \"feb\",\n  \"mar\",\n  \"apr\",\n  \"may\",\n  \"jun\",\n  \"jul\",\n  \"aug\",\n  \"sep\",\n  \"oct\",\n  \"nov\",\n  \"dec\"\n];\n\nconst formatDate = timestamp =>\n  months[timestamp.getMonth()] +\n  \" \" +\n  timestamp.getDate() +\n  \", \" +\n  timestamp.getFullYear() +\n  \" \" +\n  timestamp.getHours() +\n  \":\" +\n  timestamp.getMinutes() +\n  \":\" +\n  timestamp.getSeconds();\n\nconst rowMap = {\n  deviceStatusMarker: ({ start, end, deviceStatus, activity, duration }) => (\n    <tbody>\n      {start ? (\n        <tr className=\"capitalize\">\n          <td>Start Time</td>\n          <td>{formatDate(new Date(start.timestamp))}</td>\n        </tr>\n      ) : null}\n      {end ? (\n        <tr className=\"capitalize\">\n          <td>End Time</td>\n          <td>{formatDate(new Date(end.timestamp))}</td>\n        </tr>\n      ) : null}\n      {duration ? (\n        <tr>\n          <td>Duration</td>\n          <td>{utils.secondsToHms(duration)}</td>\n        </tr>\n      ) : null}\n      {activity ? (\n        <tr>\n          <td>Activity</td>\n          <td className=\"capitalize\">{activity}</td>\n        </tr>\n      ) : null}\n    </tbody>\n  ),\n  locationMarker: ({ coordinates: [lat, lng], alt, recorded_at }) => (\n    <tbody>\n      <tr>\n        <td>Coordinates</td>\n        <td className=\"capitalize\">\n          {lat} {lng}\n        </td>\n      </tr>\n      {alt ? (\n        <tr>\n          <td>Altitude</td>\n          <td className=\"capitalize\">{alt}</td>\n        </tr>\n      ) : null}\n      {recorded_at ? (\n        <tr>\n          <td>Recorded at</td>\n          <td className=\"capitalize\">{formatDate(new Date(recorded_at))}</td>\n        </tr>\n      ) : null}\n    </tbody>\n  )\n};\n\nconst headerMap = {\n  locationMarker: () => \"location\",\n  deviceStatusMarker: ({ deviceStatus }) => deviceStatus\n};\n\nconst DeviceStatusTable = ({ type, ...props }) => (\n  <table className=\"device-status-table\">\n    <thead>\n      <tr>\n        <th colSpan={2} className=\"capitalize\">\n          {headerMap[type](props)}\n        </th>\n      </tr>\n    </thead>\n    {rowMap[type](props)}\n  </table>\n);\n\nexport default DeviceStatusTable;\n","import React from \"react\";\n\nimport TripInfoModal from \"./components/TripInfoModal\";\nimport DeviceStatusTable from \"./components/DeviceStatusTable\";\n\nimport { mapUtils, hooks, classes, utils } from \"./common\";\n\nimport \"@blueprintjs/icons/lib/css/blueprint-icons.css\";\nimport \"@blueprintjs/core/lib/css/blueprint.css\";\nimport \"./App.css\";\n\nconst mapContainerId = \"map-container\";\n\nconst getStatusTable = props => <DeviceStatusTable {...props} />;\n\nconst params = new URLSearchParams(window.location.search);\n\nconst gistURL = params.get(\"gist\");\n\nconst locationArrays = params.get(\"locations\");\n\nconst shed_animation = params.get(\"shed_animation\") === \"true\";\n\nconst urlAccessToken = params.get(\"accessToken\");\n\nconst hash =\n  params.get(\"hash\") && params.get(\"hash\") === \"false\" ? false : true;\n\nconst coordinates = JSON.parse(locationArrays);\n\nfunction App() {\n  const [showTripModal, updateShowTripModal] = React.useState(true);\n\n  const [json, updateJson] = React.useState(undefined);\n  const [error, updateError] = React.useState(undefined);\n\n  const [state, dispatch] = React.useReducer(utils.baseReducer, {\n    jsons: [],\n    currentJson: 0\n  });\n  const { jsons, currentJson } = state || {};\n\n  const accessToken = hooks.useAccessToken(urlAccessToken, updateError);\n  const fitBoundsOptions = { linear: shed_animation };\n\n  const mapRef = hooks.useMap(mapContainerId, {\n    accessToken,\n    hash,\n    fitBoundsOptions\n  });\n  const markersRef = React.useRef([]);\n\n  const locationPopupRef = hooks.usePopup(mapRef);\n  const deviceStatusPopupRef = hooks.usePopup(mapRef, { offset: 10 });\n\n  React.useEffect(() => {\n    if (accessToken) {\n      if (gistURL) {\n        const gistId = gistURL.split(\"/\").pop();\n        fetch(`https://api.github.com/gists/${gistId}`)\n          .then(response => response.json())\n          .then(data => {\n            if (data.message) {\n              console.error(data.message);\n              updateError(data.message);\n            } else {\n              const json = JSON.parse(\n                data.files[\"default.json\"]\n                  ? data.files[\"default.json\"].content\n                  : Object.values(data.files)[0].content\n              );\n              updateJson(json);\n            }\n          })\n          .catch(error => {\n            console.error(error);\n            updateError(error);\n          });\n      } else if (coordinates && coordinates.length) {\n        const line = new classes.Line({ coordinates, type: \"LineString\" });\n        mapRef.current.on(\"load\", () =>\n          handleJsonUpdate({\n            json: line,\n            fromLocalStorage: true,\n            showModal: false\n          })\n        );\n      } else {\n        const previousJSON = localStorage.getItem(\"previousJSON\");\n        const tripJSON = JSON.parse(previousJSON);\n        if (tripJSON)\n          mapRef.current.on(\"load\", () =>\n            handleJsonUpdate({ json: tripJSON, fromLocalStorage: true })\n          );\n      }\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [accessToken]);\n\n  React.useEffect(() => {\n    if (jsons) updateJson(jsons[currentJson]);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [currentJson]);\n\n  React.useEffect(() => {\n    const indexNameMap = {\n      0: \"_zero_\",\n      1: \"_one_\"\n    };\n    jsons.forEach((json, index) => {\n      if (json.type === \"LineString\") {\n        const line = new classes.Line(json);\n        mapUtils.plotLine({\n          mapRef,\n          popupRef: locationPopupRef,\n          line,\n          getStatusTable,\n          fitBoundsOptions,\n          index: indexNameMap[index]\n        });\n      } else {\n        try {\n          const { locations, markers } = json.summary;\n          const line = new classes.Line(locations);\n          const deviceStatusMarkers = utils.markersByType(markers)(\n            \"device_status\"\n          );\n          mapUtils.plotLine({\n            mapRef,\n            popupRef: locationPopupRef,\n            line,\n            getStatusTable,\n            fitBoundsOptions,\n            index: indexNameMap[index]\n          });\n          mapUtils.useMarkers({\n            mapRef,\n            popupRef: deviceStatusPopupRef,\n            markersRef,\n            deviceStatusMarkers,\n            getStatusTable,\n            index: indexNameMap[index]\n          });\n        } catch (error) {\n          console.error(error);\n          updateError(error);\n        }\n      }\n    });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [jsons.length]);\n\n  const handleJsonUpdate = ({\n    json,\n    fromLocalstorage,\n    showModal,\n    noPageChange\n  }) => {\n    updateJson(json);\n    dispatch({ type: utils.reducerActions.addNewJson, json, noPageChange });\n    if (!fromLocalstorage)\n      localStorage.setItem(\"previousJSON\", JSON.stringify(json, null, \"\\t\"));\n    updateShowTripModal(!showModal);\n  };\n\n  const goToPageZero = () =>\n    dispatch({ type: utils.reducerActions.changeJsonIndex, index: 0 });\n\n  return (\n    <div className=\"app-container\">\n      {accessToken && <div id={mapContainerId} />}\n      <TripInfoModal\n        fetchError={error}\n        trip={json}\n        showTripModal={showTripModal}\n        showModal={() => updateShowTripModal(true)}\n        hideModal={() => updateShowTripModal(false)}\n        updateJson={handleJsonUpdate}\n        currentJsonIndex={currentJson}\n        goToPageZero={goToPageZero}\n      />\n    </div>\n  );\n}\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport App from \"./App\";\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n"],"sourceRoot":""}