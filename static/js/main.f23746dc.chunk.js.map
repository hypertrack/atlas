{"version":3,"sources":["common/map-utils.js","common/map-classes.js","common/map-hooks.js","common/utils.js","components/TripInfoModal.js","components/DeviceStatusTable.js","App.js","index.js"],"names":["getNewLayerRemoveOldLayer","mapRef","primitive","newLayerId","current","getLayer","oldLayerId","removeLayer","removeSource","mouseEnterCallback","e","popupRef","getCanvas","style","cursor","coordinates","features","geometry","slice","description","properties","Math","abs","lngLat","lng","setLngLat","setHTML","addTo","mouseLeaveCallback","remove","plotLine","line","getStatusTable","addLayer","id","type","source","data","layout","paint","fitBounds","point","mapboxgl","LngLat","initBounds","LngLatBounds","reduce","bounds","lat","extend","computeBounds","padding","top","bottom","left","right","map","alt","recorded_at","ReactDOMServer","renderToString","icon","classes","Point","on","event","plotMarkers","deviceStatusMarkers","start","end","deviceStatus","activity","duration","location","utils","getIcon","Line","this","useMap","container","React","useRef","useEffect","Map","accessToken","keyboard","center","usePopup","options","Popup","closeButton","closeOnClick","trip_schema","require","validate","allErrors","compile","getStartEndData","acc","timestamp","markerTypeMap","geofence","marker","arrival","arrivalPoint","geofencePoint","arrivalTime","geofenceId","geofence_id","geofenceMetadata","JSON","stringify","metadata","radius","Number","device_status","value","extra","parseMarker","iconMap","stop","walk","run","drive","cycle","disconnected","inactive","active","defaultIcon","secondsToHms","d","h","floor","m","s","markersByType","markers","allMarkers","currentMarker","validateTripJSON","trip","errors","TripInfoModal","showTripModal","updateJson","hideModal","showModal","useState","userJson","updateUserJson","undefined","filename","updateFilename","updateErrors","validateInput","tripJSON","validationErrors","length","Boolean","intent","Intent","SUCCESS","className","onClick","isOpen","title","onClose","Classes","DIALOG_BODY","disabled","onChange","target","placeholder","onBlur","preventDefault","parse","error","console","bordered","key","dataPath","message","DIALOG_FOOTER","DIALOG_FOOTER_ACTIONS","text","buttonText","onInputChange","fileReader","FileReader","file","files","name","readAsText","onload","onloadEvent","derivedFileValue","result","inputProps","accept","PRIMARY","updatedJson","months","formatDate","getMonth","getDate","getFullYear","getHours","getMinutes","getSeconds","rowMap","deviceStatusMarker","Date","locationMarker","headerMap","DeviceStatusTable","props","colSpan","defaultJSON","mapContainerId","loadDefault","URLSearchParams","window","search","get","App","updateShowTripModal","json","hooks","handleJsonUpdate","fromLocalstorage","localStorage","setItem","summary","locations","mapUtils","history","replaceState","previousJSON","getItem","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.f23746dc.chunk.js","sourcesContent":["import mapboxgl from \"mapbox-gl\";\n\nimport { utils, classes } from \"./\";\n\nimport ReactDOMServer from \"react-dom/server\";\n\nconst computeBounds = coordinates => {\n  const point = new mapboxgl.LngLat(coordinates[0][0], coordinates[0][1]);\n  const initBounds = new mapboxgl.LngLatBounds(point, point);\n  return coordinates.reduce(\n    (bounds, [lng, lat]) => bounds.extend(new mapboxgl.LngLat(lng, lat)),\n    initBounds\n  );\n};\n\nconst getNewLayerRemoveOldLayer = (mapRef, primitive) => {\n  let newLayerId = primitive;\n  if (\n    mapRef.current.getLayer(primitive) ||\n    mapRef.current.getLayer(`${primitive}1`)\n  ) {\n    newLayerId = mapRef.current.getLayer(primitive)\n      ? `${primitive}1`\n      : primitive;\n    const oldLayerId = mapRef.current.getLayer(primitive)\n      ? primitive\n      : `${primitive}1`;\n    mapRef.current.removeLayer(oldLayerId);\n    mapRef.current.removeSource(oldLayerId);\n  }\n  return newLayerId;\n};\n\nconst mouseEnterCallback = (e, mapRef, popupRef) => {\n  mapRef.current.getCanvas().style.cursor = \"pointer\";\n  let coordinates = e.features[0].geometry.coordinates.slice();\n  const description = e.features[0].properties.description;\n  while (Math.abs(e.lngLat.lng - coordinates[0]) > 180)\n    coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;\n  popupRef.current\n    .setLngLat(coordinates)\n    .setHTML(description)\n    .addTo(mapRef.current);\n};\n\nconst mouseLeaveCallback = (mapRef, popupRef) => {\n  mapRef.current.getCanvas().style.cursor = \"\";\n  popupRef.current.remove();\n};\n\nconst plotLine = (mapRef, popupRef, line, getStatusTable) => {\n  let newLayerId = getNewLayerRemoveOldLayer(mapRef, \"route\");\n  mapRef.current\n    .addLayer({\n      id: newLayerId,\n      type: \"line\",\n      source: {\n        type: \"geojson\",\n        data: {\n          type: \"Feature\",\n          properties: {},\n          geometry: line\n        }\n      },\n      layout: {\n        \"line-join\": \"round\",\n        \"line-cap\": \"round\"\n      },\n      paint: {\n        \"line-color\": \"#6f4cff\",\n        \"line-width\": 8\n      }\n    })\n    .fitBounds(computeBounds(line.coordinates), {\n      padding: { top: 40, bottom: 40, left: 20, right: 20 }\n    });\n\n  newLayerId = getNewLayerRemoveOldLayer(mapRef, \"locationMarkers\");\n  mapRef.current.addLayer({\n    id: newLayerId,\n    type: \"symbol\",\n    source: {\n      type: \"geojson\",\n      data: {\n        type: \"FeatureCollection\",\n        features: line.coordinates.map(([lng, lat, alt, recorded_at]) => ({\n          type: \"Feature\",\n          properties: {\n            description: ReactDOMServer.renderToString(\n              getStatusTable({\n                type: \"locationMarker\",\n                coordinates: [lat, lng],\n                alt,\n                recorded_at\n              })\n            ),\n            icon: \"marker\"\n          },\n          geometry: new classes.Point({\n            type: \"Point\",\n            coordinates: [lng, lat]\n          })\n        }))\n      }\n    },\n    layout: {\n      \"icon-image\": \"{icon}-15\",\n      \"icon-allow-overlap\": false\n    }\n  });\n\n  mapRef.current.on(\"mouseenter\", newLayerId, event =>\n    mouseEnterCallback(event, mapRef, popupRef)\n  );\n\n  mapRef.current.on(\"mouseleave\", newLayerId, () =>\n    mouseLeaveCallback(mapRef, popupRef)\n  );\n};\n\nconst plotMarkers = (mapRef, popupRef, deviceStatusMarkers, getStatusTable) => {\n  const newLayerId = getNewLayerRemoveOldLayer(mapRef, \"deviceStatusMarkers\");\n  mapRef.current.addLayer({\n    id: newLayerId,\n    type: \"symbol\",\n    source: {\n      type: \"geojson\",\n      data: {\n        type: \"FeatureCollection\",\n        features: deviceStatusMarkers.reduce(\n          (features, { start, end, deviceStatus, activity, duration }) =>\n            start.location && end.location\n              ? [\n                  ...features,\n                  {\n                    type: \"Feature\",\n                    properties: {\n                      description: ReactDOMServer.renderToString(\n                        getStatusTable({\n                          type: \"deviceStatusMarker\",\n                          start,\n                          end,\n                          deviceStatus\n                        })\n                      ),\n                      icon: utils.getIcon(\n                        deviceStatus,\n                        activity,\n                        \"circle-stroked\"\n                      )\n                    },\n                    geometry: start.location\n                  },\n                  {\n                    type: \"Feature\",\n                    properties: {\n                      description: ReactDOMServer.renderToString(\n                        getStatusTable({\n                          type: \"deviceStatusMarker\",\n                          start,\n                          end,\n                          deviceStatus,\n                          activity,\n                          duration\n                        })\n                      ),\n                      icon: utils.getIcon(deviceStatus, activity, \"circle\")\n                    },\n                    geometry: end.location\n                  }\n                ]\n              : [\n                  ...features,\n                  {\n                    type: \"Feature\",\n                    properties: {\n                      description: ReactDOMServer.renderToString(\n                        getStatusTable({\n                          type: \"deviceStatusMarker\",\n                          start,\n                          end,\n                          deviceStatus,\n                          activity,\n                          duration\n                        })\n                      ),\n                      icon: utils.getIcon(deviceStatus, activity)\n                    },\n                    geometry: end.location || start.location\n                  }\n                ],\n          []\n        )\n      }\n    },\n    layout: {\n      \"icon-image\": \"{icon}-15\",\n      \"icon-allow-overlap\": true\n    }\n  });\n\n  mapRef.current.on(\"mouseenter\", newLayerId, event =>\n    mouseEnterCallback(event, mapRef, popupRef)\n  );\n\n  mapRef.current.on(\"mouseleave\", newLayerId, () =>\n    mouseLeaveCallback(mapRef, popupRef)\n  );\n};\n\nexport default {\n  plotLine,\n  plotMarkers\n};\n","class Line {\n  constructor({ type, coordinates }) {\n    this.type = type;\n    this.coordinates = coordinates;\n  }\n}\n\nclass Point {\n  constructor({ type, coordinates }) {\n    this.type = type;\n    this.coordinates = coordinates;\n  }\n}\n\nexport default {\n  Line,\n  Point\n};\n","import React from \"react\";\n\nimport mapboxgl from \"mapbox-gl\";\n\nconst useMap = container => {\n  const mapRef = React.useRef();\n  React.useEffect(() => {\n    if (!mapRef || !mapRef.current)\n      mapRef.current = new mapboxgl.Map({\n        container,\n        style: \"mapbox://styles/mapbox/streets-v9\",\n        accessToken:\n          \"pk.eyJ1IjoiaHlwZXJ0cmFjay1kZXZvcHMiLCJhIjoiY2ptZzVndTduMWZ0YzNrbzFuNXR0cHUyOSJ9.Te8DokzaOXSVdh7ntUptyA\",\n        keyboard: true,\n        center: [0, 0]\n      });\n  }, [container]);\n  return mapRef;\n};\n\nconst usePopup = (mapRef, options) => {\n  const popupRef = React.useRef(\n    new mapboxgl.Popup({\n      closeButton: false,\n      closeOnClick: false\n    })\n  );\n  React.useEffect(() => {\n    mapRef.current.on(\"load\", () => {\n      popupRef.current.addTo(mapRef.current);\n    });\n  }, [mapRef, popupRef]);\n  return popupRef;\n};\n\nexport default {\n  useMap,\n  usePopup\n};\n","import { classes } from \"./\";\nconst trip_schema = require(\"./trip_schema.json\");\n\nconst Ajv = require(\"ajv\");\nconst ajv = new Ajv({ allErrors: true });\nconst validate = ajv.compile(trip_schema);\n\nconst parseGeofenceMarker = marker => {\n  const { arrival, geofence } = marker;\n  const arrivalPoint = new classes.Point(arrival.location.geometry);\n  const geofencePoint = new classes.Point(geofence.geometry);\n  const arrivalTime = arrival.location.recorded_at;\n  const geofenceId = geofence.geofence_id;\n  const geofenceMetadata = JSON.stringify(geofence.metadata, null, 2);\n  const radius = Number(geofence.radius);\n  return {\n    arrival: {\n      arrivalPoint,\n      arrivalTime\n    },\n    geofence: {\n      geofencePoint,\n      geofenceId,\n      geofenceMetadata,\n      radius\n    }\n  };\n};\n\nconst getStartEndData = ({ recorded_at, location }) => {\n  let acc = {};\n  if (recorded_at) acc.timestamp = recorded_at;\n  if (location && location.geometry)\n    acc.location = new classes.Point(location.geometry);\n  return acc;\n};\n\nconst parseDeviceStatusMarker = marker => {\n  const { activity, duration } = marker;\n  const deviceStatus = marker.value;\n  const end = getStartEndData(marker.end);\n  const start = getStartEndData(marker.start);\n  let extra = {};\n  if (activity) extra.activity = activity;\n  if (duration) extra.duration = duration;\n  return { start, end, deviceStatus, ...extra };\n};\n\nconst markerTypeMap = {\n  geofence: parseGeofenceMarker,\n  device_status: parseDeviceStatusMarker\n};\n\nconst parseMarker = ({ type, data }) => markerTypeMap[type](data);\n\nconst iconMap = {\n  stop: \"cafe\",\n  walk: \"pitch\",\n  run: \"skiing\",\n  drive: \"car\",\n  cycle: \"bicycle\",\n  disconnected: \"cross\",\n  inactive: \"roadblock\",\n  active: \"rocket\"\n};\n\nconst getIcon = (deviceStatus, activity, defaultIcon) =>\n  iconMap[activity] || defaultIcon || iconMap[deviceStatus];\n\nconst markersByType = markers => type => {\n  const allMarkers = markers.reduce(\n    (markers, currentMarker) => ({\n      ...markers,\n      [currentMarker.type]: markers[currentMarker.type]\n        ? [parseMarker(currentMarker), ...markers[currentMarker.type]]\n        : [parseMarker(currentMarker)]\n    }),\n    {}\n  );\n  return type && allMarkers[type] ? allMarkers[type] : allMarkers;\n};\n\nconst secondsToHms = d => {\n  d = Number(d);\n  const h = Math.floor(d / 3600);\n  const m = Math.floor((d % 3600) / 60);\n  const s = Math.floor((d % 3600) % 60);\n\n  const hDisplay = h > 0 ? h + \" h \" : \"\";\n  const mDisplay = m > 0 ? m + \" m \" : \"\";\n  const sDisplay = s > 0 ? s + \" s\" : \"\";\n  return hDisplay + mDisplay + sDisplay;\n};\n\nconst validateTripJSON = trip => {\n  const valid = validate(trip);\n  return !valid ? validate.errors : false;\n};\n\nexport default {\n  parseMarker,\n  getIcon,\n  secondsToHms,\n  markersByType,\n  validateTripJSON\n};\n","import React from \"react\";\nimport {\n  TextArea,\n  Dialog,\n  Button,\n  Classes,\n  Intent,\n  FileInput,\n  HTMLTable\n} from \"@blueprintjs/core\";\n\nimport { utils } from \"./../common\";\n\nimport \"./component.css\";\n\nconst TripInfoModal = ({\n  trip,\n  showTripModal,\n  updateJson,\n  hideModal,\n  showModal\n}) => {\n  const [userJson, updateUserJson] = React.useState(\n    JSON.stringify(trip, null, \"\\t\")\n  );\n  const [filename, updateFilename] = React.useState(undefined);\n  const [errors, updateErrors] = React.useState(\"\");\n\n  React.useEffect(() => {\n    if (JSON.stringify(trip) !== JSON.stringify(userJson))\n      updateUserJson(JSON.stringify(trip, null, \"\\t\"));\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [trip]);\n\n  const validateInput = tripJSON => {\n    const validationErrors = utils.validateTripJSON(tripJSON);\n    if (validationErrors && validationErrors.length)\n      updateErrors(validationErrors);\n    else updateErrors(null);\n    return Boolean(validationErrors);\n  };\n\n  const handleUpdateJson = e => {\n    try {\n      const updatedJson = JSON.parse(userJson);\n      updateJson(updatedJson);\n      hideModal();\n    } catch (error) {\n      console.error(error);\n      updateErrors([error]);\n    }\n  };\n\n  const handleCloseModal = e => {\n    updateUserJson(JSON.stringify(trip, null, \"\\t\"));\n    hideModal();\n  };\n\n  const handleFileUpload = event => {\n    event && event.preventDefault();\n    const fileReader = new FileReader();\n    const file = event.target.files[0];\n    updateFilename(file && file.name ? file.name : undefined);\n    fileReader.readAsText(file, \"UTF-8\");\n    fileReader.onload = onloadEvent => {\n      const derivedFileValue = onloadEvent.target.result;\n      const tripJSON = JSON.parse(derivedFileValue);\n      updateUserJson(derivedFileValue);\n      if (!validateInput(tripJSON)) {\n        updateJson(tripJSON);\n        hideModal();\n      }\n    };\n  };\n\n  const handleBlurEvent = event => {\n    event && event.preventDefault();\n    const value = event.target.value;\n    if (value)\n      try {\n        const tripJSON = JSON.parse(value);\n        validateInput(tripJSON);\n      } catch (error) {\n        console.error(error);\n        updateErrors([error]);\n      }\n  };\n\n  return (\n    <>\n      <Button\n        intent={Intent.SUCCESS}\n        className={\"show-trip-button\"}\n        onClick={() => (showTripModal ? hideModal() : showModal())}\n      >\n        Update JSON\n      </Button>\n      <Dialog\n        isOpen={errors || showTripModal}\n        title=\"Add your own JSON\"\n        onClose={hideModal}\n        className=\"dialog\"\n      >\n        <div className={Classes.DIALOG_BODY}>\n          <div className=\"dialog-container\">\n            <TextArea\n              value={userJson}\n              disabled={false}\n              onChange={e => updateUserJson(e.target.value)}\n              className={\"user-summary-input\"}\n              placeholder={\"Paste trip_summary here\"}\n              onBlur={handleBlurEvent}\n            />\n            {errors && errors.length ? (\n              <div className={\"error-table-container\"}>\n                <HTMLTable className={\"error-table\"} bordered>\n                  <caption>\n                    There {errors.length > 1 ? \"are\" : \"is an\"}{\" \"}\n                    {errors.length > 1 ? errors.length : \"\"} issue\n                    {errors.length > 1 ? \"s\" : \"\"}\n                  </caption>\n                  <thead>\n                    <tr>\n                      <th>Location</th>\n                      <th>Issue</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    {errors.map(error => (\n                      <tr key={error.dataPath}>\n                        <td>\n                          <div className=\"table-content\">{error.dataPath}</div>\n                        </td>\n                        <td>\n                          <div className=\"table-content\">{error.message}</div>\n                        </td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </HTMLTable>\n              </div>\n            ) : null}\n          </div>\n        </div>\n        <div className={Classes.DIALOG_FOOTER}>\n          <div className={Classes.DIALOG_FOOTER_ACTIONS}>\n            <FileInput\n              text={filename}\n              buttonText={\"Browse\"}\n              className=\"file-input\"\n              onInputChange={handleFileUpload}\n              inputProps={{ accept: \".json\" }}\n            />\n            <Button\n              disabled={(errors && errors.length) || !userJson}\n              onClick={handleCloseModal}\n            >\n              Close\n            </Button>\n            <Button\n              intent={Intent.PRIMARY}\n              disabled={(errors && errors.length) || !userJson}\n              onClick={handleUpdateJson}\n            >\n              Update\n            </Button>\n          </div>\n        </div>\n      </Dialog>\n    </>\n  );\n};\n\nexport default TripInfoModal;\n","import React from \"react\";\n\nimport { utils } from \"./../common\";\n\nimport \"./component.css\";\n\nconst months = [\n  \"jan\",\n  \"feb\",\n  \"mar\",\n  \"apr\",\n  \"may\",\n  \"jun\",\n  \"jul\",\n  \"aug\",\n  \"sep\",\n  \"oct\",\n  \"nov\",\n  \"dec\"\n];\n\nconst formatDate = timestamp =>\n  months[timestamp.getMonth()] +\n  \" \" +\n  timestamp.getDate() +\n  \", \" +\n  timestamp.getFullYear() +\n  \" \" +\n  timestamp.getHours() +\n  \":\" +\n  timestamp.getMinutes() +\n  \":\" +\n  timestamp.getSeconds();\n\nconst rowMap = {\n  deviceStatusMarker: ({ start, end, deviceStatus, activity, duration }) => (\n    <tbody>\n      {start ? (\n        <tr className=\"capitalize\">\n          <td>Start Time</td>\n          <td>{formatDate(new Date(start.timestamp))}</td>\n        </tr>\n      ) : null}\n      {end ? (\n        <tr className=\"capitalize\">\n          <td>End Time</td>\n          <td>{formatDate(new Date(end.timestamp))}</td>\n        </tr>\n      ) : null}\n      {duration ? (\n        <tr>\n          <td>Duration</td>\n          <td>{utils.secondsToHms(duration)}</td>\n        </tr>\n      ) : null}\n      {activity ? (\n        <tr>\n          <td>Activity</td>\n          <td className=\"capitalize\">{activity}</td>\n        </tr>\n      ) : null}\n    </tbody>\n  ),\n  locationMarker: ({ coordinates: [lat, lng], alt, recorded_at }) => (\n    <tbody>\n      <tr>\n        <td>Coordinates</td>\n        <td className=\"capitalize\">\n          {lat} {lng}\n        </td>\n      </tr>\n      <tr>\n        <td>Altitude</td>\n        <td className=\"capitalize\">{alt}</td>\n      </tr>\n      <tr>\n        <td>Recorded at</td>\n        <td className=\"capitalize\">{formatDate(new Date(recorded_at))}</td>\n      </tr>\n    </tbody>\n  )\n};\n\nconst headerMap = {\n  locationMarker: () => \"location\",\n  deviceStatusMarker: ({ deviceStatus }) => deviceStatus\n};\n\nconst DeviceStatusTable = ({ type, ...props }) => (\n  <table className=\"device-status-table\">\n    <thead>\n      <tr>\n        <th colSpan={2} className=\"capitalize\">\n          {headerMap[type](props)}\n        </th>\n      </tr>\n    </thead>\n    {rowMap[type](props)}\n  </table>\n);\n\nexport default DeviceStatusTable;\n","import React from \"react\";\n\nimport TripInfoModal from \"./components/TripInfoModal\";\nimport DeviceStatusTable from \"./components/DeviceStatusTable\";\n\nimport { mapUtils, hooks, classes, utils } from \"./common\";\n\nimport \"@blueprintjs/icons/lib/css/blueprint-icons.css\";\nimport \"@blueprintjs/core/lib/css/blueprint.css\";\nimport \"./App.css\";\n\nconst defaultJSON = require(\"./template/default.json\");\n\nconst mapContainerId = \"map-container\";\n\nconst getStatusTable = props => <DeviceStatusTable {...props} />;\n\nconst params = new URLSearchParams(window.location.search);\n\nconst loadDefault = params.get(\"loadDefault\") === \"true\";\n\nfunction App() {\n  const [showTripModal, updateShowTripModal] = React.useState(true);\n  const [json, updateJson] = React.useState(\n    loadDefault ? defaultJSON : undefined\n  );\n  const mapRef = hooks.useMap(mapContainerId);\n  const popupRef = hooks.usePopup(mapRef);\n\n  const handleJsonUpdate = (json, fromLocalstorage) => {\n    updateJson(json);\n    if (!fromLocalstorage)\n      localStorage.setItem(\"previousJSON\", JSON.stringify(json, null, \"\\t\"));\n    const { locations, markers } = json.summary;\n    const line = new classes.Line(locations);\n    const deviceStatusMarkers = utils.markersByType(markers)(\"device_status\");\n    mapUtils.plotLine(mapRef, popupRef, line, getStatusTable);\n    mapUtils.plotMarkers(mapRef, popupRef, deviceStatusMarkers, getStatusTable);\n  };\n\n  React.useEffect(() => {\n    if (loadDefault) window.history.replaceState({}, \"\", \"?loadDefault=false\");\n    else {\n      const previousJSON = localStorage.getItem(\"previousJSON\");\n      const tripJSON = JSON.parse(previousJSON);\n      if (tripJSON)\n        mapRef.current.on(\"load\", () => {\n          handleJsonUpdate(tripJSON, true);\n        });\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  return (\n    <div className=\"app-container\">\n      <div id={mapContainerId} />\n      <TripInfoModal\n        trip={json}\n        showTripModal={showTripModal}\n        showModal={() => updateShowTripModal(true)}\n        hideModal={() => updateShowTripModal(false)}\n        updateJson={handleJsonUpdate}\n      />\n    </div>\n  );\n}\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport App from \"./App\";\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n"],"sourceRoot":""}